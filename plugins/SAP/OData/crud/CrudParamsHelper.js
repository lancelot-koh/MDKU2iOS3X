"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
var ODataLinkCreator_1 = require("./odatalinking/odatalinkers/ODataLinkCreator");
var ODataLinkDeleter_1 = require("./odatalinking/odatalinkers/ODataLinkDeleter");
var ODataLinkUpdater_1 = require("./odatalinking/odatalinkers/ODataLinkUpdater");
var ErrorMessage_1 = require("../../ErrorHandling/ErrorMessage");
var CrudParamsHelper = /** @class */ (function () {
    function CrudParamsHelper() {
    }
    CrudParamsHelper.getHeadersFromParams = function (params) {
        var headers = params[CrudParamsHelper.HEADERSKEY];
        if (headers != null) {
            return headers;
        }
        else {
            return null;
        }
    };
    CrudParamsHelper.getServiceFromParams = function (params) {
        var service = params[CrudParamsHelper.SERVICEKEY];
        if (service != null && Object.keys(service).length > 0) {
            return service;
        }
        else {
            throw new Error(ErrorMessage_1.ErrorMessage.format(ErrorMessage_1.ErrorMessage.ODATA_MALFORMED_PARAMS, this.MALFORMEDPARAM, this.SERVICEKEY));
        }
    };
    CrudParamsHelper.getServiceUrlFromService = function (params) {
        var serviceUrl = params[CrudParamsHelper.SERVICEURLKEY];
        if (typeof serviceUrl === 'string' && serviceUrl.length !== 0) {
            return serviceUrl;
        }
        else {
            throw new Error(ErrorMessage_1.ErrorMessage.format(ErrorMessage_1.ErrorMessage.ODATA_MALFORMED_PARAMS, this.MALFORMEDPARAM, this.SERVICEURLKEY));
        }
    };
    CrudParamsHelper.getEntitySetNameFromService = function (params) {
        var entitySet = params[CrudParamsHelper.ENTITYSETNAMEKEY];
        if (typeof entitySet === 'string' && entitySet.length !== 0) {
            return entitySet;
        }
        else {
            throw new Error(ErrorMessage_1.ErrorMessage.format(ErrorMessage_1.ErrorMessage.ODATA_MALFORMED_PARAMS, this.MALFORMEDPARAM, this.ENTITYSETNAMEKEY));
        }
    };
    CrudParamsHelper.getPropertiesFromService = function (params) {
        var properties = params[CrudParamsHelper.ENTITYPROPERTIESKEY];
        if (properties != null) {
            return properties;
        }
        else {
            throw new Error(ErrorMessage_1.ErrorMessage.format(ErrorMessage_1.ErrorMessage.ODATA_MALFORMED_PARAMS, this.MALFORMEDPARAM, this.ENTITYPROPERTIESKEY));
        }
    };
    CrudParamsHelper.getLinkCreatorsFromParams = function (params) {
        var linkCreatorParams = params[CrudParamsHelper.CREATELINKS];
        if (!Array.isArray(linkCreatorParams) || linkCreatorParams.length === 0) {
            return null;
        }
        var linkCreators = new Array(linkCreatorParams.length);
        var service = this.getServiceFromParams(params);
        var entitySetName = this.getEntitySetNameFromService(service);
        for (var i = 0; i < linkCreatorParams.length; i++) {
            var linkCreator = new ODataLinkCreator_1.ODataLinkCreator(entitySetName, linkCreatorParams[i]);
            linkCreators[i] = linkCreator;
        }
        return linkCreators;
    };
    CrudParamsHelper.getLinkUpdatersFromParams = function (params) {
        var linkUpdaterParams = params[CrudParamsHelper.UPDATELINKS];
        if (!Array.isArray(linkUpdaterParams) || linkUpdaterParams.length === 0) {
            return null;
        }
        var linkUpdaters = new Array(linkUpdaterParams.length);
        var service = this.getServiceFromParams(params);
        var entitySetName = this.getEntitySetNameFromService(service);
        for (var i = 0; i < linkUpdaterParams.length; i++) {
            var linkUpdater = new ODataLinkUpdater_1.ODataLinkUpdater(entitySetName, linkUpdaterParams[i]);
            linkUpdaters[i] = linkUpdater;
        }
        return linkUpdaters;
    };
    CrudParamsHelper.getLinkDeletersFromParams = function (params) {
        var linkDeleterParams = params[CrudParamsHelper.DELETELINKS];
        if (!Array.isArray(linkDeleterParams) || linkDeleterParams.length === 0) {
            return null;
        }
        var linkDeleters = new Array(linkDeleterParams.length);
        var service = this.getServiceFromParams(params);
        var entitySetName = this.getEntitySetNameFromService(service);
        for (var i = 0; i < linkDeleterParams.length; i++) {
            var linkDeleter = new ODataLinkDeleter_1.ODataLinkDeleter(entitySetName, linkDeleterParams[i]);
            linkDeleters[i] = linkDeleter;
        }
        return linkDeleters;
    };
    CrudParamsHelper.MALFORMEDPARAM = 'Malformed parameter:';
    CrudParamsHelper.SERVICEKEY = 'service';
    CrudParamsHelper.SERVICEURLKEY = 'serviceUrl';
    CrudParamsHelper.ENTITYSETNAMEKEY = 'entitySet';
    CrudParamsHelper.ENTITYPROPERTIESKEY = 'properties';
    CrudParamsHelper.CREATELINKS = 'createLinks';
    CrudParamsHelper.UPDATELINKS = 'updateLinks';
    CrudParamsHelper.DELETELINKS = 'deleteLinks';
    CrudParamsHelper.HEADERSKEY = 'headers';
    return CrudParamsHelper;
}());
exports.CrudParamsHelper = CrudParamsHelper;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQ3J1ZFBhcmFtc0hlbHBlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIkNydWRQYXJhbXNIZWxwZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUFBQSxpRkFBZ0Y7QUFDaEYsaUZBQWdGO0FBQ2hGLGlGQUFnRjtBQUNoRixpRUFBZ0U7QUFFaEU7SUFBQTtJQStHQSxDQUFDO0lBNUdlLHFDQUFvQixHQUFsQyxVQUFtQyxNQUFXO1FBQzVDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksSUFBSSxDQUFDLENBQUMsQ0FBQztZQUNwQixNQUFNLENBQUMsT0FBTyxDQUFDO1FBQ2pCLENBQUM7UUFBQyxJQUFJLENBQUMsQ0FBQztZQUNOLE1BQU0sQ0FBQyxJQUFJLENBQUM7UUFDZCxDQUFDO0lBQ0gsQ0FBQztJQUVhLHFDQUFvQixHQUFsQyxVQUFtQyxNQUFXO1FBQzVDLElBQUksT0FBTyxHQUFHLE1BQU0sQ0FBQyxnQkFBZ0IsQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsRCxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksSUFBSSxJQUFJLE1BQU0sQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUMsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDLENBQUM7WUFDdkQsTUFBTSxDQUFDLE9BQU8sQ0FBQztRQUNqQixDQUFDO1FBQUMsSUFBSSxDQUFDLENBQUM7WUFDTixNQUFNLElBQUksS0FBSyxDQUFDLDJCQUFZLENBQUMsTUFBTSxDQUFDLDJCQUFZLENBQUMsc0JBQXNCLEVBQUUsSUFBSSxDQUFDLGNBQWMsRUFDMUYsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDLENBQUM7UUFDdEIsQ0FBQztJQUNILENBQUM7SUFFYSx5Q0FBd0IsR0FBdEMsVUFBdUMsTUFBVztRQUNoRCxJQUFJLFVBQVUsR0FBRyxNQUFNLENBQUMsZ0JBQWdCLENBQUMsYUFBYSxD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LENBQUM7UUFDaEQsSUFBSSxhQUFhLEdBQUcsSUFBSSxDQUFDLDJCQUEyQixDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBRTlELEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUcsaUJBQWlCLENBQUMsTUFBTSxFQUFFLENBQUMsRUFBRSxFQUFFLENBQUM7WUFDbEQsSUFBSSxXQUFXLEdBQUcsSUFBSSxtQ0FBZ0IsQ0FBQyxhQUFhLEVBQUUsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQztZQUM1RSxZQUFZLENBQUMsQ0FBQyxDQUFDLEdBQUcsV0FBVyxDQUFDO1FBQ2hDLENBQUM7UUFDRCxNQUFNLENBQUMsWUFBWSxDQUFDO0lBQ3RCLENBQUM7SUFwR3VCLCtCQUFjLEdBQVcsc0JBQXNCLENBQUM7SUFzR2hELDJCQUFVLEdBQVcsU0FBUyxDQUFDO0lBQy9CLDhCQUFhLEdBQVcsWUFBWSxDQUFDO0lBQ3JDLGlDQUFnQixHQUFXLFdBQVcsQ0FBQztJQUN2QyxvQ0FBbUIsR0FBVyxZQUFZLENBQUM7SUFDM0MsNEJBQVcsR0FBVyxhQUFhLENBQUM7SUFDcEMsNEJBQVcsR0FBVyxhQUFhLENBQUM7SUFDcEMsNEJBQVcsR0FBVyxhQUFhLENBQUM7SUFDcEMsMkJBQVUsR0FBVyxTQUFTLENBQUM7SUFDekQsdUJBQUM7Q0FBQSxBQS9HRCxJQStHQztBQS9HWSw0Q0FBZ0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBPRGF0YUxpbmtDcmVhdG9yIH0gZnJvbSAnLi9vZGF0YWxpbmtpbmcvb2RhdGFsaW5rZXJzL09EYXRhTGlua0NyZWF0b3InO1xuaW1wb3J0IHsgT0RhdGFMaW5rRGVsZXRlciB9IGZyb20gJy4vb2RhdGFsaW5raW5nL29kYXRhbGlua2Vycy9PRGF0YUxpbmtEZWxldGVyJztcbmltcG9ydCB7IE9EYXRhTGlua1VwZGF0ZXIgfSBmcm9tICcuL29kYXRhbGlua2luZy9vZGF0YWxpbmtlcnMvT0RhdGFMaW5rVXBkYXRlcic7XG5pbXBvcnQgeyBFcnJvck1lc3NhZ2UgfSBmcm9tICcuLi8uLi9FcnJvckhhbmRsaW5nL0Vycm9yTWVzc2FnZSc7XG5cbmV4cG9ydCBjbGFzcyBDcnVkUGFyYW1zSGVscGVyIHtcbiAgcHVibGljIHN0YXRpYyByZWFkb25seSAgTUFMRk9STUVEUEFSQU06IHN0cmluZyA9ICdNYWxmb3JtZWQgcGFyYW1ldGVyOic7XG4gIFxuICBwdWJsaWMgc3RhdGljIGdldEhlYWRlcnNGcm9tUGFyYW1zKHBhcmFtczogYW55KTogYW55IHtcbiAgICBsZXQgaGVhZGVycyA9IHBhcmFtc1tDcnVkUGFyYW1zSGVscGVyLkhFQURFUlNLRVldO1xuICAgIGlmIChoZWFkZXJzICE9IG51bGwpIHtcbiAgICAgIHJldHVybiBoZWFkZXJzO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldFNlcnZpY2VGcm9tUGFyYW1zKHBhcmFtczogYW55KTogYW55IHtcbiAgICBsZXQgc2VydmljZSA9IHBhcmFtc1tDcnVkUGFyYW1zSGVscGVyLlNFUlZJQ0VLRVldO1xuICAgIGlmIChzZXJ2aWNlICE9IG51bGwgJiYgT2JqZWN0LmtleXMoc2VydmljZSkubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIHNlcnZpY2U7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihFcnJvck1lc3NhZ2UuZm9ybWF0KEVycm9yTWVzc2FnZS5PREFUQV9NQUxGT1JNRURfUEFSQU1TLCB0aGlzLk1BTEZPUk1FRFBBUkFNLCBcbiAgICAgICAgdGhpcy5TRVJWSUNFS0VZKSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRTZXJ2aWNlVXJsRnJvbVNlcnZpY2UocGFyYW1zOiBhbnkpOiBzdHJpbmcge1xuICAgIGxldCBzZXJ2aWNlVXJsID0gcGFyYW1zW0NydWRQYXJhbXNIZWxwZXIuU0VSVklDRVVSTEtFWV07XG4gICAgaWYgKHR5cGVvZiBzZXJ2aWNlVXJsID09PSAnc3RyaW5nJyAmJiBzZXJ2aWNlVXJsLmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV0dXJuIHNlcnZpY2VVcmw7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihFcnJvck1lc3NhZ2UuZm9ybWF0KEVycm9yTWVzc2FnZS5PREFUQV9NQUxGT1JNRURfUEFSQU1TLCB0aGlzLk1BTEZPUk1FRFBBUkFNLCBcbiAgICAgICAgdGhpcy5TRVJWSUNFVVJMS0VZKSk7XG4gICAgfVxuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRFbnRpdHlTZXROYW1lRnJvbVNlcnZpY2UocGFyYW1zOiBhbnkpOiBzdHJpbmcge1xuICAgIGxldCBlbnRpdHlTZXQgPSBwYXJhbXNbQ3J1ZFBhcmFtc0hlbHBlci5FTlRJVFlTRVROQU1FS0VZXTtcbiAgICBpZiAodHlwZW9mIGVudGl0eVNldCA9PT0gJ3N0cmluZycgJiYgZW50aXR5U2V0Lmxlbmd0aCAhPT0gMCkge1xuICAgICAgcmV0dXJuIGVudGl0eVNldDtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKEVycm9yTWVzc2FnZS5mb3JtYXQoRXJyb3JNZXNzYWdlLk9EQVRBX01BTEZPUk1FRF9QQVJBTVMsIHRoaXMuTUFMRk9STUVEUEFSQU0sIFxuICAgICAgICB0aGlzLkVOVElUWVNFVE5BTUVLRVkpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldFByb3BlcnRpZXNGcm9tU2VydmljZShwYXJhbXM6IGFueSk6IGFueSB7XG4gICAgbGV0IHByb3BlcnRpZXMgPSBwYXJhbXNbQ3J1ZFBhcmFtc0hlbHBlci5FTlRJVFlQUk9QRVJUSUVTS0VZXTtcbiAgICBpZiAocHJvcGVydGllcyAhPSBudWxsKSB7XG4gICAgICByZXR1cm4gcHJvcGVydGllcztcbiAgICB9IGVsc2Uge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKEVycm9yTWVzc2FnZS5mb3JtYXQoRXJyb3JNZXNzYWdlLk9EQVRBX01BTEZPUk1FRF9QQVJBTVMsIHRoaXMuTUFMRk9STUVEUEFSQU0sIFxuICAgICAgICB0aGlzLkVOVElUWVBST1BFUlRJRVNLRVkpKTtcbiAgICB9XG4gIH1cblxuICBwdWJsaWMgc3RhdGljIGdldExpbmtDcmVhdG9yc0Zyb21QYXJhbXMocGFyYW1zOiBhbnkpOiBhbnkge1xuICAgIGxldCBsaW5rQ3JlYXRvclBhcmFtcyA9IHBhcmFtc1tDcnVkUGFyYW1zSGVscGVyLkNSRUFURUxJTktTXTtcbiAgICBpZiAoIUFycmF5LmlzQXJyYXkobGlua0NyZWF0b3JQYXJhbXMpIHx8IGxpbmtDcmVhdG9yUGFyYW1zLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgbGV0IGxpbmtDcmVhdG9ycyA9IG5ldyBBcnJheShsaW5rQ3JlYXRvclBhcmFtcy5sZW5ndGgpO1xuICAgIGxldCBzZXJ2aWNlID0gdGhpcy5nZXRTZXJ2aWNlRnJvbVBhcmFtcyhwYXJhbXMpO1xuICAgIGxldCBlbnRpdHlTZXROYW1lID0gdGhpcy5nZXRFbnRpdHlTZXROYW1lRnJvbVNlcnZpY2Uoc2VydmljZSk7XG5cbiAgICBmb3IgKGxldCBpID0gMDsgaSA8IGxpbmtDcmVhdG9yUGFyYW1zLmxlbmd0aDsgaSsrKSB7XG4gICAgICBsZXQgbGlua0NyZWF0b3IgPSBuZXcgT0RhdGFMaW5rQ3JlYXRvcihlbnRpdHlTZXROYW1lLCBsaW5rQ3JlYXRvclBhcmFtc1tpXSk7XG4gICAgICBsaW5rQ3JlYXRvcnNbaV0gPSBsaW5rQ3JlYXRvcjtcbiAgICB9XG4gICAgcmV0dXJuIGxpbmtDcmVhdG9ycztcbiAgfVxuXG4gIHB1YmxpYyBzdGF0aWMgZ2V0TGlua1VwZGF0ZXJzRnJvbVBhcmFtcyhwYXJhbXM6IGFueSk6IGFueSB7XG4gICAgbGV0IGxpbmtVcGRhdGVyUGFyYW1zID0gcGFyYW1zW0NydWRQYXJhbXNIZWxwZXIuVVBEQVRFTElOS1NdO1xuICAgIGlmICghQXJyYXkuaXNBcnJheShsaW5rVXBkYXRlclBhcmFtcykgfHwgbGlua1VwZGF0ZXJQYXJhbXMubGVuZ3RoID09PSAwKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICBsZXQgbGlua1VwZGF0ZXJzID0gbmV3IEFycmF5KGxpbmtVcGRhdGVyUGFyYW1zLmxlbmd0aCk7XG4gICAgbGV0IHNlcnZpY2UgPSB0aGlzLmdldFNlcnZpY2VGcm9tUGFyYW1zKHBhcmFtcyk7XG4gICAgbGV0IGVudGl0eVNldE5hbWUgPSB0aGlzLmdldEVudGl0eVNldE5hbWVGcm9tU2VydmljZShzZXJ2aWNlKTtcblxuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbGlua1VwZGF0ZXJQYXJhbXMubGVuZ3RoOyBpKyspIHtcbiAgICAgIGxldCBsaW5rVXBkYXRlciA9IG5ldyBPRGF0YUxpbmtVcGRhdGVyKGVudGl0eVNldE5hbWUsIGxpbmtVcGRhdGVyUGFyYW1zW2ldKTtcbiAgICAgIGxpbmtVcGRhdGVyc1tpXSA9IGxpbmtVcGRhdGVyO1xuICAgIH1cbiAgICByZXR1cm4gbGlua1VwZGF0ZXJzO1xuICB9XG5cbiAgcHVibGljIHN0YXRpYyBnZXRMaW5rRGVsZXRlcnNGcm9tUGFyYW1zKHBhcmFtczogYW55KTogYW55IHtcbiAgICBsZXQgbGlua0RlbGV0ZXJQYXJhbXMgPSBwYXJhbXNbQ3J1ZFBhcmFtc0hlbHBlci5ERUxFVEVMSU5LU107XG4gICAgaWYgKCFBcnJheS5pc0FycmF5KGxpbmtEZWxldGVyUGFyYW1zKSB8fCBsaW5rRGVsZXRlclBhcmFtcy5sZW5ndGggPT09IDApIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIGxldCBsaW5rRGVsZXRlcnMgPSBuZXcgQXJyYXkobGlua0RlbGV0ZXJQYXJhbXMubGVuZ3RoKTtcbiAgICBsZXQgc2VydmljZSA9IHRoaXMuZ2V0U2VydmljZUZyb21QYXJhbXMocGFyYW1zKTtcbiAgICBsZXQgZW50aXR5U2V0TmFtZSA9IHRoaXMuZ2V0RW50aXR5U2V0TmFtZUZyb21TZXJ2aWNlKHNlcnZpY2UpO1xuXG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBsaW5rRGVsZXRlclBhcmFtcy5sZW5ndGg7IGkrKykge1xuICAgICAgbGV0IGxpbmtEZWxldGVyID0gbmV3IE9EYXRhTGlua0RlbGV0ZXIoZW50aXR5U2V0TmFtZSwgbGlua0RlbGV0ZXJQYXJhbXNbaV0pO1xuICAgICAgbGlua0RlbGV0ZXJzW2ldID0gbGlua0RlbGV0ZXI7XG4gICAgfVxuICAgIHJldHVybiBsaW5rRGVsZXRlcnM7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBTRVJWSUNFS0VZOiBzdHJpbmcgPSAnc2VydmljZSc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFNFUlZJQ0VVUkxLRVk6IHN0cmluZyA9ICdzZXJ2aWNlVXJsJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgRU5USVRZU0VUTkFNRUtFWTogc3RyaW5nID0gJ2VudGl0eVNldCc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IEVOVElUWVBST1BFUlRJRVNLRVk6IHN0cmluZyA9ICdwcm9wZXJ0aWVzJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgQ1JFQVRFTElOS1M6IHN0cmluZyA9ICdjcmVhdGVMaW5rcyc7XG4gIHByaXZhdGUgc3RhdGljIHJlYWRvbmx5IFVQREFURUxJTktTOiBzdHJpbmcgPSAndXBkYXRlTGlua3MnO1xuICBwcml2YXRlIHN0YXRpYyByZWFkb25seSBERUxFVEVMSU5LUzogc3RyaW5nID0gJ2RlbGV0ZUxpbmtzJztcbiAgcHJpdmF0ZSBzdGF0aWMgcmVhZG9ubHkgSEVBREVSU0tFWTogc3RyaW5nID0gJ2hlYWRlcnMnO1xufVxuIl19